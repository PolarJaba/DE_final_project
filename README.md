# Итоговый проект №5

## Служба такси

<b>Выбор технологического стека</b>

Использован следующий стек технологий:

1. В качестве СУБД использован Postgres, поскольку таблица не требует высокой скорости чтения для аналитики и при расширении функционала БД службы такси она скорее будет ориентирована на запись, причем небольшого количества строк за раз.

2. Язык скриптов - python, библиотеки psycopg2 для подключения к БД и обмена данными и pandas для обработки данных датафреймами, а также выгрузки данных из БД в формате parquet.

3. Проект завернут в docker-compose.

Рассматривалась также возможность использвания hdfs, однако объем исходного файла небольшой (0,5 Гб) и формат данных столбцов определен достаточно точно из-за чего использование такого инструмента скорее излишне.

Проект представлен в двух вариантах: version1 (рабочий), version2 (~~теоретически~~ рабочий), принципиальных отличий нет, различается работа с данными core-слоя. В первой версии необходимо предварительно обработать данные для core-слоя и поместить их в нужную директорию, во второй -
весь процесс обработки и загрузки данных в БД происходит автоматически (требует большого объема свободной памяти).

<i> Прим. из-за веса файлов с данными (соответственно сырые и обработанные а также слой витрин) и необходимости их обработки развертывание docker-compose требует большого количества свободной памяти (около 3GB или более)</i>

<b>Работа с данными</b> 

<b>version1</b>

1. Требуеся предварительная подготовка файла с очищенными данными. Необходимо запустить скрипт [dataframe_processing](https://github.com/PolarJaba/DE_final/blob/main/version1/app/scripts/dataframe_processing.py) и поместить полученный файл в папку init_db/data. Здесь производится преобразование формата, проверка на существование всех необходимых значений строки, их адекватность.

2. При запуске docker-compose происходит загрузка данных в БД Postgres и создние витрины данных, а также ее выгрузка в формате parquet в отдельную директорию внутри контейнера.

<b>version2</b>

Работа осуществляется в несколько этапов:

1. Загрузка данных из файла yellow_tripdata в слой сырых данных без каких-либо изменений.

2. Получение части данных путем запроса к БД, для опимизации работы запрашиваются только отдельные столбцы, производится проверка на адекватность значений (например, расстояние или конечная стоимость путешествия не могут быть отрицательными величинами).

3. Преобразование полученных даннных в dataframe, конечная очистка.

4. Загрузка данных в core-слой.

5. Создание и заполнение витрины данных путем запроса к БД.

<b>Структура проекта</b>

![image](https://github.com/PolarJaba/DE_final/blob/main/version1/figs/structure.PNG)

<i>Прим. разделы figs и results не используются для работы docker-compose и необходимы только для демонстрации проекта</i>

<b>Результаты</b>

Получены 3 слоя БД: 

RAW:

![image](https://github.com/PolarJaba/DE_final/blob/main/version1/figs/er_raw.PNG)

CORE: 

![image](https://github.com/PolarJaba/DE_final/blob/main/version1/figs/er_core.PNG)

MART:

![image](https://github.com/PolarJaba/DE_final/blob/main/version1/figs/er_mart.PNG)

Витрина данных содержит информацию о процентном соотношении поездок такси с различным количеством пассажиров по датам:

![image](https://github.com/PolarJaba/DE_final/blob/main/version1/figs/data_mart.PNG)

Также составлена витрина для получения информации о минимальной и максимальной стоимости поездки за день:

![image](https://github.com/PolarJaba/DE_final/blob/main/version1/figs/min_max_cost_dm.PNG)

<b>Попытка ответа на дополнительный вопрос</b>

Скрипт [data_analysis](https://github.com/PolarJaba/DE_final/blob/main/version1/app/scripts/data_analysis.py) (не инициализируется docker-compose) содержит программу для построения графика рассеяния, отвечающего на вопрос "Как количество пассажиров и дальность поездки влияют на чаевые?".

Получен график:

![image](https://github.com/PolarJaba/DE_final/blob/main/version1/app/scripts/scatter_plot_1-2.png)

<b>Выводы:</b>

Получен работоспособный проект, инициализирующий БД службы такси, состоящую из трех слоев данных. Написаны скрипты для обработки и очистки сырых данных и получения витрины. 

При ответе на дополнительный вопрос сделан вывод, что чаще всего таксист получает большую сумму чаевых при поездке на расстояние 50-100, если в машине находятся 1, 2 или 5 человек.

Проект можно доработать улучшив качество очистки данных при инициализации core-слоя и обработки данных при аналитике, а также оптимизировав его с точки зрения затрат памяти.
