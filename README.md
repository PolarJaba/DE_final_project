# Итоговый проект №5

## Служба такси

<b>Выбор технологического стека</b>

Использован следующий стек технологий:

1. В качестве СУБД использован Postgres, поскольку таблица не требует высокой скорости чтения для аналитики и при расширении функционала БД службы такси она скорее будет ориентирована на запись, причем небольшого количества строк за раз.

2. Язык скриптов - python, библиотеки psycopg2 для подключения к БД и обмена данными и pandas для обработки данных датафреймами, а также выгрузки данных из БД в формате parquet.

3. Проект завернут в docker-compose.

Рассматривалась также возможность использвания hdfs, однако объем исходного файла небольшой (0,5 Гб) и формат данных столбцов определен достаточно точно из-за чего использование такого инструмента скорее излишне.

<i> Прим. из-за веса файлов с данными (соответственно сырые и обработанные а также слой витрин) и необходимости их обработки развертывание docker-compose требует большого количества свободной памяти (около 5GB или более)</i>

<b>Рекомендации по развертыванию проекта</b>

1. Скачайте весь проект (можно исключить папку result и файл README) в локальную директорию.

2. Перейдите по ссылке в [файле README](https://github.com/PolarJaba/DE_final_project/blob/main/init_db/data/README.md) и скачайте файл сырых данных yellow_tripdata в папку init_db/data.

3. В коммандной строке перейдите в директорию, в которую загрузили проект и введите команду:

```
docker-compose up
```

<b>Работа с данными</b> 

Осуществляется в несколько этапов:

Скрипт [main](https://github.com/PolarJaba/DE_final_project/blob/main/app/scripts/main.py)

  1. Загрузка данных из файла yellow_tripdata в слой сырых данных без каких-либо изменений.

  2. Получение части данных путем запроса к БД, их очистка от пустых и явно ошибочных значений (например отрицательных значений пройденного пути).

  3. Загрузка данных в core-слой.

Скрипт [queries](https://github.com/PolarJaba/DE_final_project/blob/main/app/scripts/queries.py)

  1. Создание витрины данных о соотношении количества поездок с различным количеством пассажиров в различные дни.

  2. Создание витрины данных о максимальном и минимальном значении полной стоимости поездки такси с различным количеством пассажиров в различные дни.

  Заполнение витрин происходит через запрос к БД.

Скрипт [data_load](https://github.com/PolarJaba/DE_final_project/blob/main/app/scripts/data_load.py)

  1. Выгрузка витрин из БД в формат parquet.

<b>Структура проекта</b>

![image](https://github.com/PolarJaba/DE_final_project/blob/main/result/figs/structure.PNG)

<i>Прим. разделы figs и results не используются для работы docker-compose и необходимы только для демонстрации проекта</i>

<b>Результаты</b>

Получены 3 слоя БД: 

RAW:

![image](https://github.com/PolarJaba/DE_final_project/blob/main/result/figs/er_raw.PNG)

CORE: 

![image](https://github.com/PolarJaba/DE_final_project/blob/main/result/figs/er_core.PNG)

MART:

![image](https://github.com/PolarJaba/DE_final_project/blob/main/result/figs/er_mart.PNG)

Витрина данных содержит информацию о процентном соотношении поездок такси с различным количеством пассажиров по датам:

![image](https://github.com/PolarJaba/DE_final_project/blob/main/result/figs/data_mart.PNG)

Также составлена витрина для получения информации о минимальной и максимальной стоимости поездки за день:

![image](https://github.com/PolarJaba/DE_final_project/blob/main/result/figs/min_max_cost_dm.PNG)

<b>Попытка ответа на дополнительный вопрос</b>

Скрипт [data_analysis](https://github.com/PolarJaba/DE_final_project/blob/main/app/scripts/data_analysis.py) (не инициализируется docker-compose) содержит программу для построения графика рассеяния, отвечающего на вопрос "Как количество пассажиров и дальность поездки влияют на чаевые?".

Получен график:

![image](https://github.com/PolarJaba/DE_final_project/blob/main/result/figs/scatter_plot_1-2.png)

<b>Выводы:</b>

Получен работоспособный проект, инициализирующий БД службы такси, состоящую из трех слоев данных. Написаны скрипты для обработки и очистки сырых данных и получения витрины. 

При ответе на дополнительный вопрос сделан вывод, что чаще всего таксист получает большую сумму чаевых при поездке на расстояние 50-100, если в машине находятся 1, 2 или 5 человек.

Проект можно доработать улучшив качество очистки данных при инициализации core-слоя и обработки данных при аналитике, а также оптимизировав его с точки зрения затрат памяти.
